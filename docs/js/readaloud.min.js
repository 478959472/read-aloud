function getQueryString(){var e={};return location.search&&location.search.substr(1).replace(/\+/g,"%20").split("&").forEach(function(n){var t=n.split("=");e[decodeURIComponent(t[0])]=t[1]&&decodeURIComponent(t[1])}),e}function getSettings(){return new Promise(function(e){chrome.storage.local.get(["voiceName","rate","pitch","volume","showHighlighting"],e)})}function updateSettings(e){return new Promise(function(n){chrome.storage.local.set(e,n)})}function clearSettings(){return new Promise(function(e){chrome.storage.local.remove(["voiceName","rate","pitch","volume","showHighlighting"],e)})}function getState(e){return new Promise(function(n){chrome.storage.local.get(e,function(t){n(t[e])})})}function setState(e,n){var t={};return t[e]=n,new Promise(function(e){chrome.storage.local.set(t,e)})}function getVoices(){return new Promise(function(e){chrome.tts.getVoices(e)})}function isGoogleNative(e){return/^Google /.test(e)}function isGoogleTranslate(e){return/^GoogleTranslate /.test(e)}function isAmazonPolly(e){return/^Amazon /.test(e)}function isRemoteVoice(e){return isAmazonPolly(e)||isGoogleTranslate(e)}function isPremiumVoice(e){return isAmazonPolly(e)}function executeFile(e){return new Promise(function(n,t){chrome.runtime.lastError=null,chrome.tabs.executeScript({file:e},function(e){chrome.runtime.lastError?t(new Error(chrome.runtime.lastError.message)):n(e)})})}function executeScript(e){return new Promise(function(n,t){chrome.runtime.lastError=null,chrome.tabs.executeScript({code:e},function(e){chrome.runtime.lastError?t(new Error(chrome.runtime.lastError.message)):n(e)})})}function insertCSS(e){return new Promise(function(n,t){chrome.runtime.lastError=null,chrome.tabs.insertCSS({file:e},function(e){chrome.runtime.lastError?t(new Error(chrome.runtime.lastError.message)):n(e)})})}function getBackgroundPage(){return new Promise(function(e){chrome.runtime.getBackgroundPage(e)})}function spread(e,n){return function(t){return e.apply(n,t)}}function callMethod(e,n){return function(t){return t[e].apply(t,n)}}function waitMillis(e){return new Promise(function(n){setTimeout(n,e)})}function parseLang(e){var n=e.toLowerCase().replace(/_/g,"-").split(/-/,2);return{lang:n[0],rest:n[1]}}function formatError(e){var n=chrome.i18n.getMessage(e.code);return n&&(n=n.replace(/{(\w+)}/g,function(n,t){return e[t]})),n}function urlEncode(e){if(null==e)return null;var n=[];for(var t in e)n.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return n.join("&")}function ajaxGet(e){return new Promise(function(n,t){var r=new XMLHttpRequest;r.open("GET",e,!0),r.onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(200==r.status?n(r.responseText):t(new Error(r.responseText)))},r.send(null)})}function ajaxPost(e,n){return new Promise(function(t,r){var o=new XMLHttpRequest;o.open("POST",e,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.onreadystatechange=function(){o.readyState==XMLHttpRequest.DONE&&(200==o.status?t(o.responseText):r(new Error(o.responseText)))},o.send(urlEncode(n))})}function connect(e){window.docReady||(window.docReady=makeDoc()),window.docReady.then(function(n){startService(e,n)})}function startService(e,n){function t(){return window.getSelection().toString().trim()}function r(e){return e.replace(/https?:\/\/\S+/g,"this URL.")}var o=chrome.runtime.connect({name:e});o.onMessage.addListener(function(e,n){var t=n.request;if(e[t.method]){var r=e[t.method](t);Promise.resolve(r).then(function(e){o.postMessage({id:n.id,response:e})})}}.bind(null,{raGetInfo:function(e){var t=document.documentElement.lang||$("html").attr("xml:lang");return"en"==t&&(t=null),{isPdf:n.isPdf,canSeek:n.canSeek,url:location.href,title:document.title,lang:t}},raGetCurrentIndex:function(e){return t()?-100:n.getCurrentIndex()},raGetTexts:function(e){return e.index<0?-100==e.index?t().split(readAloud.paraSplitter):null:Promise.resolve(n.getTexts(e.index)).then(function(e){return e&&(e=e.map(r),console.log(e.join("\n\n"))),e})}}))}function makeDoc(){return new Promise(function(e){$(e)}).then(function(){return"docs.google.com"==location.hostname?$(".kix-appview-editor").length?new GoogleDoc:$(".drive-viewer-paginated-scrollable").length?new GDriveDoc:new HtmlDoc:"drive.google.com"==location.hostname?new GDriveDoc:/^read\.amazon\./.test(location.hostname)?new KindleBook:"www.quora.com"==location.hostname?new QuoraPage:"www.khanacademy.org"==location.hostname?new KhanAcademy:location.pathname.match(/\.pdf$/)?new PdfDoc(location.href):$("embed[type='application/pdf']").length?new PdfDoc($("embed[type='application/pdf']").attr("src")):new HtmlDoc}).then(function(e){return Promise.resolve(e.ready).then(function(){return e})})}function GoogleDoc(){function e(){return $(".kix-paragraphrenderer",this).get().map(function(e){return e.innerText.trim()}).filter(isNotEmpty)}var n=$(".kix-appview-editor").get(0),t=$(".kix-page");this.getCurrentIndex=function(){for(var e=0;e<t.length&&!(t.eq(e).position().top>n.scrollTop+$(n).height()/2);e++);return e-1},this.getTexts=function(r){var o=t.get(r);return o?(n.scrollTop=$(o).position().top,tryGetTexts(e.bind(o),2e3)):null}}function GDriveDoc(){function e(){return fixParagraphs($("p",this).get().map(function(e){return e.innerText.trim()}).filter(isNotEmpty))}var n=$(".drive-viewer-paginated-scrollable").get(0),t=$(".drive-viewer-paginated-page");this.getCurrentIndex=function(){for(var e=0;e<t.length&&!(t.eq(e).position().top>n.scrollTop+$(n).height()/2);e++);return e-1},this.getTexts=function(r){var o=t.get(r);return o?(n.scrollTop=$(o).position().top,tryGetTexts(e.bind(o),3e3)):null}}function KindleBook(){function e(){var e=[];a.filter(function(e){return"hidden"!=e.style.visibility}).forEach(function(n){var t=$(n).height();$("h1, h2, h3, h4, h5, h6, .was-a-p",n.contentDocument).each(function(){var n=$(this).offset().top;$(this).height();n>=0&&n<t&&e.push($(this).text())})});for(var t=[],r=0;r<e.length;r++)e[r]!=(t.length?t[t.length-1]:n)&&t.push(e[r]);return n=t[t.length-1],t}var n,t=document.getElementById("KindleReaderIFrame").contentDocument,r=t.getElementById("kindleReader_pageTurnAreaRight"),o=t.getElementById("kindleReader_pageTurnAreaLeft"),a=[t.getElementById("column_0_frame_0"),t.getElementById("column_0_frame_1"),t.getElementById("column_1_frame_0"),t.getElementById("column_1_frame_1")],i=0;this.getCurrentIndex=function(){return i=0},this.getTexts=function(n){for(;i<n;i++)$(r).click();for(;i>n;i--)$(o).click();return tryGetTexts(e,4e3)}}function PdfDoc(e){function n(e){return e.getTextContent().then(function(e){for(var n=[],t=0;t<e.items.length;t++)(0==n.length||t>0&&e.items[t-1].transform[5]!=e.items[t].transform[5])&&n.push(""),n[n.length-1]+=e.items[t].str;return n.map(function(e){return e.trim()})}).then(fixParagraphs)}function t(){return a?Promise.resolve():(PDFJS.workerSrc=chrome.runtime.getURL("/js/pdf.worker.js"),PDFJS.getDocument(e).promise.then(function(e){a=e}))}function r(){if(!$(".pdf-upload-dialog:visible").length){var e=$("<div>").addClass("pdf-upload-dialog");$("<p>").text(o({code:"uploadpdf_message1",extension_name:chrome.i18n.getMessage("extension_short_name")})).css("color","blue").appendTo(e),$("<p>").text(o({code:"uploadpdf_message2",extension_name:chrome.i18n.getMessage("extension_short_name")})).appendTo(e);var n=$("<form>").attr("action","https://support2.lsdsoftware.com/dropmeafile-readaloud/upload").attr("method","POST").attr("enctype","multipart/form-data").on("submit",function(){t.prop("disabled",!0)}).appendTo(e);$("<input>").attr("type","file").attr("name","fileToUpload").attr("accept","application/pdf").on("change",function(){t.prop("disabled",!$(this).val())}).appendTo(n),$("<br>").appendTo(n),$("<br>").appendTo(n);var t=$("<input>").attr("type","submit").attr("value",chrome.i18n.getMessage("uploadpdf_submit_button")).prop("disabled",!0).appendTo(n);e.appendTo(document.body).dialog({title:chrome.i18n.getMessage("extension_short_name"),width:400,modal:!0})}}function o(e){var n=chrome.i18n.getMessage(e.code);return n&&(n=n.replace(/{(\w+)}/g,function(n,t){return e[t]})),n}var a;this.isPdf=!0,this.canSeek=!0,this.getCurrentIndex=function(){return 0},this.getTexts=function(o){return/^file:/.test(e)?(r(),Promise.resolve(null)):t().then(function(){return o<a.numPages?a.getPage(o+1).then(n):null})}}function QuoraPage(){function e(){var e=[],n=$(".QuestionArea .question_qtext").get(0);return n&&e.push(n.innerText),$(".AnswerBase").each(function(){(n=$(this).find(".feed_item_answer_user .user").get(0))&&e.push("Answer by "+n.innerText),(n=$(this).find(".rendered_qtext").get(0))&&e.push.apply(e,n.innerText.split(readAloud.paraSplitter)),(n=$(this).find(".AnswerFooter").get(0))&&e.push(n.innerText)}),e}this.getCurrentIndex=function(){return 0},this.getTexts=function(n){return 0==n?e():null}}function KhanAcademy(){function e(){return $("h1:first").add($("> :not(ul, ol), > ul > li, > ol > li",".paragraph:not(.paragraph .paragraph)")).get().map(function(e){var n=e.innerText.trim();return $(e).is("li")?$(e).index()+1+". "+n:n})}this.getCurrentIndex=function(){return 0},this.getTexts=function(n){return 0==n?e():null}}function HtmlDoc(){function e(){var e=[],r=function(){if($(this).is(p+", a"));else if(n(this))e.push(this);else if($(this).is("frame, iframe"))try{r.call(this.contentDocument.body)}catch(e){}else $(this).children().each(r)};r.call(document.body),e=$(e).filter(":visible").filter(l).get();for(var o=[],i=0;i<e.length;i++)o.push.apply(o,a(e[i],e[i-1])),o.push(e[i]);return $(o).addClass("read-aloud"),u(o.map(t)).filter(isNotEmpty)}function n(e){return c(e).some(function(e){return 1==e.nodeType&&$(e).is("p")&&e.innerText.trim().length>100||3==e.nodeType&&e.nodeValue.trim().length>100})}function t(e){$(e).find("ol, ul").each(function(){$(this).children("li").each(function(e){$(this.firstChild).is(".read-aloud-numbering")||$("<span>").addClass("read-aloud-numbering").text(e+1+". ").prependTo(this)})}),$(e).find(".read-aloud-numbering").show();var n=$(e).find(":visible").filter(r).toggle(),t=o(e.innerText).trim().split(readAloud.paraSplitter);return n.toggle(),$(e).find(".read-aloud-numbering").hide(),t}function r(){var e=$(this).css("float"),n=$(this).css("position");return $(this).is("sup")||"right"==e||"absolute"==n||"fixed"==n}function o(e){return e.replace(/(\w)(\s*?\r?\n)/g,"$1.$2")}function a(e,n){for(var t=[],r=i($(e).find(p+", p").filter(":visible").get(0)),o=s(e,!0);o&&o!=n;){if(1==o.nodeType&&$(o).is(":visible")){var a=i(o);a<r&&(t.push(o),r=a)}o=s(o)}return t.reverse()}function i(e){var n=e&&/^H(\d)$/i.exec(e.tagName);return n?Number(n[1]):100}function s(e,n){return $(e).is("body")?null:1==e.nodeType&&!n&&e.lastChild?e.lastChild:e.previousSibling?e.previousSibling:s(e.parentNode,!0)}function l(){return $(this).offset().left>=0}function c(e){for(var n=[],t=e.firstChild;t;)n.push(t),t=t.nextSibling;return n}function u(e){return[].concat.apply([],e)}var p="H1, H2, H3, H4, H5, H6";this.getCurrentIndex=function(){return 0},this.getTexts=function(n){return 0==n?e():null}}function isNotEmpty(e){return e}function fixParagraphs(e){for(var n=[],t="",r=0;r<e.length;r++)e[r]?(t&&(/-$/.test(t)?t=t.substr(0,t.length-1):t+=" "),t+=e[r].replace(/-\r?\n/g,""),e[r].match(/[.!?:)"'\u2019\u201d]$/)&&(n.push(t),t="")):t&&(n.push(t),t="");return t&&n.push(t),n}function tryGetTexts(e,n){return function(e){return new Promise(function(n){setTimeout(n,e)})}(500).then(e).then(function(t){return t&&!t.length&&n-500>0?tryGetTexts(e,n-500):t})}function Speech(e,n){function t(){return p[0]>=e.length?(n.hack&&clearTimeout(g),u=!1,n.onEnd&&n.onEnd(),Promise.resolve()):(n.hack&&(clearTimeout(g),g=setTimeout(r,16*1e3)),u=(new Date).getTime(),new Promise(function(t){a(e[p[0]][p[1]],t,function(e){e?(n.hack&&clearTimeout(g),u=!1,n.onEnd&&n.onEnd(e)):o()})}))}function r(){c.isSpeaking(function(e){e&&o()})}function o(){return p[1]++,p[1]>=e[p[0]].length&&(p=[p[0]+1,0]),t()}function a(e,t,r){c.speak(e,{voiceName:n.voiceName,lang:n.lang,rate:n.rate,pitch:n.pitch,volume:n.volume,requiredEventTypes:["start","end"],desiredEventTypes:["start","end","error"],onEvent:function(e){"start"==e.type?t():"end"==e.type?r():"error"==e.type&&r(new Error(e.errorMessage||"Unknown TTS error"))}})}function i(){function e(e,r,o){return t(o.getPhrases(e),r,o,n)}function n(e,n,t){for(var r=t.getWords(e),o=Math.min(Math.ceil(r.length/2),n),a=[];r.length;)a.push(r.slice(0,o).join("")),r=r.slice(o);return a}function t(e,n,t,r){var o=[],a={parts:[],wordCount:0},i=function(){a.parts.length&&(o.push(a.parts.join("")),a={parts:[],wordCount:0})};return e.forEach(function(e){var s=t.getWords(e).length;if(s>n){i();for(var l=r(e,n,t),c=0;c<l.length;c++)o.push(l[c])}else a.wordCount+s>n&&i(),a.parts.push(e),a.wordCount+=s}),i(),o}this.breakText=function(n,r,o){return t(o.getSentences(n),r,o,e)}}function s(){function e(e,r,o){return t(o.getPhrases(e),r,o,n)}function n(e,n,r){return t(r.getWords(e),n,r)}function t(e,n,t,r){var o=[],a={parts:[],charCount:0},i=function(){a.parts.length&&(o.push(a.parts.join("")),a={parts:[],charCount:0})};return e.forEach(function(e){var s=e.length;if(s>n){i();for(var l=r(e,n,t),c=0;c<l.length;c++)o.push(l[c])}else a.charCount+s>n&&i(),a.parts.push(e),a.charCount+=s}),i(),o}this.breakText=function(n,r,o){return t(o.getSentences(n),r,o,e)}}n.spchletMaxLen||(n.spchletMaxLen=36),n.rate||(n.rate=1);var l;/^zh|ko|ja/.test(n.lang)?(l=new function(){this.getSentences=function(e){for(var n=e.split(/([.!?]+[\s\u200b]|[\u3002\uff01])/),t=[],r=0;r<n.length;r+=2)r+1<n.length?t.push(n[r]+n[r+1]):t.push(n[r]);return t},this.getPhrases=function(e){for(var n=e.split(/([,;:]\s|[\u2025\u2026\u3000\u3001\uff0c\uff1b])/),t=[],r=0;r<n.length;r+=2)r+1<n.length?t.push(n[r]+n[r+1]):t.push(n[r]);return t},this.getWords=function(e){return e.replace(/\s+/g,"").split("")}},n.spchletMaxLen*=2):l=new function(){this.getSentences=function(e){for(var n=e.split(/([.!?]+[\s\u200b])/),t=[],r=0;r<n.length;r+=2)r+1<n.length?t.push(n[r]+n[r+1]):t.push(n[r]);return t},this.getPhrases=function(e){for(var n=e.split(/([,;:]\s|\s-+\s|—)/),t=[],r=0;r<n.length;r+=2)r+1<n.length?t.push(n[r]+n[r+1]):t.push(n[r]);return t},this.getWords=function(e){for(var n=e.trim().split(/([~@#%^*_+=<>]|[\s\-—/]+|\.(?=\w{2,})|,(?=[0-9]))/),t=[],r=0;r<n.length;r+=2)n[r]&&t.push(n[r]),r+1<n.length&&(/^[~@#%^*_+=<>]$/.test(n[r+1])?t.push(n[r+1]):t.length&&(t[t.length-1]+=n[r+1]));return t}};var c=n.engine||chrome.tts,u=!1,p=[0,0],g=0;isAmazonPolly(n.voiceName)||isGoogleTranslate(n.voiceName)?(e=e.map(function(e){return(new s).breakText(e,200,l)}),n.hack=!1):isGoogleNative(n.voiceName)?(e=e.map(function(e){return(new i).breakText(e,n.spchletMaxLen*n.rate,l)}),n.hack=!0):(e=e.map(function(e){return[e]}),n.hack=!1),this.options=n,this.play=t,this.pause=function(){return n.hack&&clearTimeout(g),c.stop(),u=!1,Promise.resolve()},this.getState=function(){return new Promise(function(e){c.isSpeaking(function(n){e(u?n?"PLAYING":"LOADING":"PAUSED")})})},this.getPosition=function(){return{index:p,texts:e}},this.forward=function(){return p[0]+1<e.length?(p=[p[0]+1,0],t()):Promise.reject(new Error("Can't forward, at end"))},this.rewind=function(){return u&&(new Date).getTime()-u>3*1e3?(p=[p[0],0],t()):p[0]>0?(p=[p[0]-1,0],t()):Promise.reject(new Error("Can't rewind, at beginning"))},this.gotoEnd=function(){p=[Math.max(e.length-1,0),0]}}function RemoteTTS(e){function n(e){return isGoogleTranslate(e)?1.2:1}var t=window.ttsAudio;t||(t=window.ttsAudio=document.createElement("AUDIO")),this.speak=function(r,o,a){a||(a=o.onEvent),t.pause(),t.volume=o.volume||1,t.defaultPlaybackRate=(o.rate||1)*n(o.voiceName),t.src=e+"/read-aloud/speak/"+o.lang+"/"+encodeURIComponent(o.voiceName)+"?q="+encodeURIComponent(r),t.onplay=a.bind(null,{type:"start",charIndex:0}),t.onerror=a.bind(null,{type:"error",errorMessage:"TTS server error"}),t.onended=a.bind(null,{type:"end",charIndex:r.length}),t.play()},this.isSpeaking=function(e){e(t.currentTime&&!t.paused&&!t.ended)},this.stop=function(){t.pause()}}var remoteVoices=[{voice_name:"GoogleTranslate Afrikaans",lang:"af",event_types:["start","end"]},{voice_name:"GoogleTranslate Albanian",lang:"sq",event_types:["start","end"]},{voice_name:"GoogleTranslate Arabic",lang:"ar",event_types:["start","end"]},{voice_name:"GoogleTranslate Armenian",lang:"hy",event_types:["start","end"]},{voice_name:"GoogleTranslate Bengali",lang:"bn",event_types:["start","end"]},{voice_name:"GoogleTranslate Bosnian",lang:"bs",event_types:["start","end"]},{voice_name:"GoogleTranslate Catalan",lang:"ca",event_types:["start","end"]},{voice_name:"GoogleTranslate Chinese",lang:"zh-CN",event_types:["start","end"]},{voice_name:"GoogleTranslate Croatian",lang:"hr",event_types:["start","end"]},{voice_name:"GoogleTranslate Czech",lang:"cs",event_types:["start","end"]},{voice_name:"GoogleTranslate Danish",lang:"da",event_types:["start","end"]},{voice_name:"GoogleTranslate Dutch",lang:"nl",event_types:["start","end"]},{voice_name:"GoogleTranslate English",lang:"en",event_types:["start","end"]},{voice_name:"GoogleTranslate Esperanto",lang:"eo",event_types:["start","end"]},{voice_name:"GoogleTranslate Finnish",lang:"fi",event_types:["start","end"]},{voice_name:"GoogleTranslate French",lang:"fr",event_types:["start","end"]},{voice_name:"GoogleTranslate German",lang:"de",event_types:["start","end"]},{voice_name:"GoogleTranslate Greek",lang:"el",event_types:["start","end"]},{voice_name:"GoogleTranslate Hindi",lang:"hi",event_types:["start","end"]},{voice_name:"GoogleTranslate Hungarian",lang:"hu",event_types:["start","end"]},{voice_name:"GoogleTranslate Icelandic",lang:"is",event_types:["start","end"]},{voice_name:"GoogleTranslate Indonesian",lang:"id",event_types:["start","end"]},{voice_name:"GoogleTranslate Italian",lang:"it",event_types:["start","end"]},{voice_name:"GoogleTranslate Japanese",lang:"ja",event_types:["start","end"]},{voice_name:"GoogleTranslate Khmer",lang:"km",event_types:["start","end"]},{voice_name:"GoogleTranslate Korean",lang:"ko",event_types:["start","end"]},{voice_name:"GoogleTranslate Latin",lang:"la",event_types:["start","end"]},{voice_name:"GoogleTranslate Latvian",lang:"lv",event_types:["start","end"]},{voice_name:"GoogleTranslate Macedonian",lang:"mk",event_types:["start","end"]},{voice_name:"GoogleTranslate Nepali",lang:"ne",event_types:["start","end"]},{voice_name:"GoogleTranslate Norwegian",lang:"no",event_types:["start","end"]},{voice_name:"GoogleTranslate Polish",lang:"pl",event_types:["start","end"]},{voice_name:"GoogleTranslate Portuguese",lang:"pt",event_types:["start","end"]},{voice_name:"GoogleTranslate Romanian",lang:"ro",event_types:["start","end"]},{voice_name:"GoogleTranslate Russian",lang:"ru",event_types:["start","end"]},{voice_name:"GoogleTranslate Serbian",lang:"sr",event_types:["start","end"]},{voice_name:"GoogleTranslate Sinhala",lang:"si",event_types:["start","end"]},{voice_name:"GoogleTranslate Slovak",lang:"sk",event_types:["start","end"]},{voice_name:"GoogleTranslate Spanish",lang:"es",event_types:["start","end"]},{voice_name:"GoogleTranslate Swahili",lang:"sw",event_types:["start","end"]},{voice_name:"GoogleTranslate Swedish",lang:"sv",event_types:["start","end"]},{voice_name:"GoogleTranslate Tamil",lang:"ta",event_types:["start","end"]},{voice_name:"GoogleTranslate Thai",lang:"th",event_types:["start","end"]},{voice_name:"GoogleTranslate Turkish",lang:"tr",event_types:["start","end"]},{voice_name:"GoogleTranslate Ukrainian",lang:"uk",event_types:["start","end"]},{voice_name:"GoogleTranslate Vietnamese",lang:"vi",event_types:["start","end"]},{voice_name:"GoogleTranslate Welsh",lang:"cy",event_types:["start","end"]}],config={serviceUrl:"https://support.lsdsoftware.com"},defaults={rate:1,pitch:1,volume:1,showHighlighting:0},readAloud={paraSplitter:/(?:\s*\r?\n\s*){2,}/};!function(){if(window.chrome&&chrome.ttsEngine){var e=new RemoteTTS(config.serviceUrl);chrome.ttsEngine.onSpeak.addListener(e.speak),chrome.ttsEngine.onStop.addListener(e.stop)}}();readAloud=new function(){function e(){return n().then(function(e){$(".ra-play").toggle(!e),$(".ra-pause").toggle(e),a.toggle(e&&isGoogleTranslate(r.options.voiceName))})}function n(){return r?r.getState().then(function(e){return"PAUSED"!=e}):Promise.resolve(!1)}function t(e){var n;this.speak=function(t,r){n=new SpeechSynthesisUtterance,r.lang&&(n.lang=r.lang),r.pitch&&(n.pitch=r.pitch),r.rate&&(n.rate=r.rate),n.text=t,n.voice=e,r.volume&&(n.volume=r.volume),n.onstart=r.onEvent.bind(null,{type:"start",charIndex:0}),n.onerror=n.onend=r.onEvent.bind(null,{type:"end",charIndex:t.length}),speechSynthesis.speak(n)},this.isSpeaking=function(e){e(speechSynthesis.speaking)},this.stop=function(){n&&(n.onend=null),speechSynthesis.cancel()}}var r,o=new function(){function e(e,n){var t=parseLang(n),r={};return e.forEach(function(e){if(e.lang){var n=parseLang(e.lang);n.lang==t.lang&&(n.rest==t.rest?"female"==e.gender?r.first=r.first||e:r.second=r.second||e:n.rest?"en"==n.lang&&"us"==n.rest?r.fourth=e:r.fourth=r.fourth||e:r.third=r.third||e)}}),r.first||r.second||r.third||r.fourth}window.speechSynthesis&&speechSynthesis.getVoices(),this.getLocalVoice=function(n){return window.speechSynthesis?e(speechSynthesis.getVoices(),n):null},this.getRemoteVoice=function(n){return window.remoteVoices?e(remoteVoices.filter(function(e){return isAmazonPolly(e.voice_name)}),n)||e(remoteVoices.filter(function(e){return isGoogleTranslate(e.voice_name)}),n):null}},a=new function(){var e=$("<div/>").get(0);$("<div>powered&nbsp;by</div>").css({color:"#888","margin-bottom":"3px"}).appendTo(e),$("<span>G</span>").css("color","#4885ed").appendTo(e),$("<span>o</span>").css("color","#db3236").appendTo(e),$("<span>o</span>").css("color","#f4c20d").appendTo(e),$("<span>g</span>").css("color","#4885ed").appendTo(e),$("<span>l</span>").css("color","#3cba54").appendTo(e),$("<span>e</span>").css("color","#db3236").appendTo(e),$("<span>&nbsp;Translate</span>").css("color","#888").appendTo(e),$(e).css({display:"none",position:"absolute",padding:"6px",color:"black","background-color":"white","border-radius":"3px","box-shadow":"1px 1px 3px gray","font-family":"Arial, Helvetica, sans-serif","font-size":"small","text-align":"center",cursor:"pointer"}).click(function(){window.open("https://translate.google.com/","_blank")}),$(function(){$(e).appendTo(document.body)}),this.toggle=function(n){if(n){var t=$(".ra-pause").offset();t&&(t.left=Math.max(0,t.left+$(".ra-pause").outerWidth()/2-$(e).outerWidth()/2),t.top+=$(".ra-pause").height()+5,$(e).css(t).show())}else $(e).hide()}};this.play=function(n){return r?r.play().then(e):this.speak((new HtmlDoc).getTexts(0),n)},this.speak=function(n,a){if(!window.Promise)return alert("Browser not supported");var i=o.getLocalVoice(a.lang);return i?(a.voiceName=i.name,a.engine=new t(i)):(i=o.getRemoteVoice(a.lang),a.voiceName=i?i.voice_name:"default",a.engine=new RemoteTTS(config.serviceUrl)),a.onEnd=function(){r=null,e()},r&&r.pause(),(r=new Speech(n,a)).play().then(e)},this.pause=function(){return r?r.pause().then(e):Promise.resolve()},this.isPlaying=n,$(e)};